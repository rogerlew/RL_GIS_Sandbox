from __future__ import print_function

# Copyright (c) 2014, Roger Lew [see LICENSE.txt]
#
# The project described was supported by NSF award number IIA-1301792 
# from the NSF Idaho EPSCoR Program and by the National Science Foundation.

'''
This code provides elevation referencing from locally stored or network mapped 
georeferenced Digital Elevation Maps (DEM) stored in ESRI raster datasets.

This was built for Idaho and the DEMs were obtained from insideidaho.org
The data originally came from the USGS. Idaho is divided into 14 zones. Each zone
is its own raster dataset.

The datasets are named:
  ned_10m_14
  .
  .
  .
  ned_10m_14

The geoTIFF containing the 10m data is named "w001001.adf" in a sub-folder
with the same name as the dataset.
  e.g. ned10m_01/ned10m_01/w001001.adf
  
Before using the script obtain GeoTIFFS for the region you wish to reference.
You will also need to modify the Server class so it can find these DEMs. The 
server is implemented as a Singleton to avoid unintentional instances eating 
up memory. 
'''

# standard library
import fnmatch
import os

from math import ceil, floor

# 3rd party modules
from scipy import interpolate

from osgeo import gdal
from osgeo import osr
from osgeo.gdalconst import *

# see: http://www.garyrobinson.net/2004/03/python_singleto.html
from singletonmixin import Singleton

class GeoTiff:
    def __init__(self, fname):

            # open the image
            ds = gdal.Open(fname, GA_ReadOnly)

            self.fname = fname
            self.ds = ds
            self.band = ds.GetRasterBand(1)
            self.transform = self.ds.GetGeoTransform(can_return_null = True)

            self.left, self.upper = self.getLngLat(0,0)
            self.right, self.lower = self.getLngLat(ds.RasterXSize, ds.RasterYSize)


    def getLngLat(self, x, y):
        assert self.transform != None

        xOrigin, xPixSize, xZero, yOrigin, yZero, yPixSize = self.transform

        assert xZero == yZero == 0.0

        lng = xOrigin + xPixSize*x 
        lat = yOrigin + yPixSize*y  

        return lng, lat

    def getPixelCoords(self, lng, lat):
        assert self.transform != None
        
        xOrigin, xPixSize, xZero, yOrigin, yZero, yPixSize = self.transform

        assert xZero == yZero == 0.0
        
        x = (lng - xOrigin) / xPixSize
        y = (lat - yOrigin) / yPixSize

        return x, y

    def __contains__(self, (lng, lat)):
        return self.left < lng and lng < self.right and \
               self.lower < lat and lat < self.upper

    def getElevation(self, lng, lat, method='cubic'):
        x, y = self.getPixelCoords(lng, lat)
        w, h = self.ds.RasterXSize, self.ds.RasterYSize

        if method == 'bilinear':
            _x = [int(floor(x)), int(ceil(x))]
            _y = [int(floor(y)), int(ceil(y))]

            data = self.band.ReadAsArray(_x[0], _y[0], 2, 2)
            func = interpolate.interp2d(_x, _y, data, kind='linear')
            z = func(x, y)[0]
        elif method == 'cubic':
            xr, yr = int(round(x)), int(round(y))

            if xr - 2 < 0:
                _x = [0, 1, 2, 3, 4]
            elif xr + 2 > w:
                _x = [w-4, w-3, w-2, w-1, w]
            else:
                _x = [xr-2, xr-1, xr, xr+1, xr+2]
                
            if yr - 2 < 0:
                _y = [0, 1, 2, 3, 4]
            elif yr + 2 >= h:
                _y = [h-4, h-3, h-2, h-1, h]
            else:
                _y = [yr-2, yr-1, yr, yr+1, yr+2]

            data = self.band.ReadAsArray(_x[0], _y[0], 5, 5)

            func = interpolate.interp2d(_x, _y, data, kind='cubic')
            z = func(x, y)[0]
        else:
            x, y = int(round(x)), int(round(y))
            z = self.band.ReadAsArray(x, y, 1, 1)[0,0]

        return z

class Server(Singleton):
    """
    This class keeps track of the available DEMs and handles requests for elevation
    data.

    Usage
    -----

    from elevationService import Server
    s = Server.getInstance() # see http://www.garyrobinson.net/2004/03/python_singleto.html
                             # if your curious about this syntax
                             
    coords = '-116.745874072192,48.08102857446649 -116.5376828123843,47.94063756560327'

    # or
    
    coords = ['-116.745874072192,48.08102857446649', '-116.5376828123843,47.94063756560327']

    # or
    
    coords = [[-116.745874072192, 48.08102857446649], [-116.5376828123843, 47.94063756560327]]

    # or

    coords = '-116.745874072192,48.08102857446649,0 -116.5376828123843,47.94063756560327,0'

    # or
    
    coords = ['-116.745874072192,48.08102857446649,0', '-116.5376828123843,47.94063756560327,0']

    # or
    
    coords = [[-116.745874072192,0, 48.08102857446649, 0], [-116.5376828123843, 47.94063756560327, 0]]


    elevs = s.getElevations(coords)

    """
    def __init__(self, neddir = None, dem_filename='w001001.adf'):
        if neddir is None:
            self.neddir = os.getenv('NED10M_ID_PATH', '') # default to local path 
        else:
            self.neddir = neddir
    
        # register all of the drivers
        gdal.AllRegister()

        # find dem files and create handles for them
        dems = []
        for root, dirnames, filenames in os.walk(neddir):
            for filename in fnmatch.filter(filenames, dem_filename):
                dems.append(GeoTiff(os.path.join(root, filename)))

        self.dems = dems

    def _getDem(self, lng, lat):
            for dem in self.dems:
                if (lng,lat) in dem:
                    return dem

            return None

    def getElevations(self, coordinates, method='bilinear'):
        """
        Elevation interpolation between raster points can be specified as 'nearest',
        'bilinear' or 'cubic' with the method kwarg
        """
        if isinstance(coordinates, basestring):
            coordinates = [map(float, coord.split(',')) for coord in  coordinates.split()]

        elif isinstance(coordinates[0], basestring):
            coordinates =   [map(float, coord.split(',')) for coord in coordinates]

        ret = []
        for coord in coordinates:
            lng, lat = coord[:2]
            dem = self._getDem(lng, lat)
            assert dem is not None
            ret.append(dem.getElevation(lng, lat, method=method))

        return ret

if __name__ == '__main__':
    
    import numpy as np

    # This test data was generated in Google Earth and copied and pasted from testPath.kml
    # testData1 is a string of space separated coordinates and comma separated longitude, latitude, and latitude values
    # 
    testData1 = '''-116.745874072192,48.08102857446649,0 -116.5376828123843,47.94063756560327,0 -116.5242832008861,47.92340213081799,0 -116.3577461231133,47.53830768548028,0 -116.3510361075235,47.52556164092302,0 -116.3312648259745,47.4958632507878,0 -116.205909251171,47.28391909285293,0 -116.1866720950459,47.2628005621324,0 -116.1736249709838,47.2416657624534,0 -116.1544254473719,47.22055369319131,0 -116.1288135300576,47.19099797678089,0 -116.1225181566258,47.18678353025015,0 -116.0718159765087,47.14037907384641,0 -116.0592564481853,47.1319514565619,0 -116.0277559235253,47.10665269303167,0 -116.0151291610591,47.09407726433773,0 -115.8943219418863,46.9183133719481,0 -115.8816004671327,46.8973846192466,0 -115.7098174383189,46.85210835828622,0 -115.6973734835807,46.83957016496351,0 -115.6789287915006,46.83125349087171,0 -115.2994441764979,46.68026161097462,0 -115.2810656837552,46.66353371433938,0 -115.2748583039441,46.65094778758999,0 -115.232014834245,46.60911182104614,0 -115.2197366051386,46.59235323119681,0 -115.1832515274081,46.5715037916163,0 -115.1043198358729,46.5296420624102,0 -115.0920698912608,46.50861964866134,0 -115.0860003414729,46.50442145639163,0 -115.0308393733827,46.37840268479166,0 -115.0187007497269,46.36164855632493,0 -115.0125090385228,46.33231421595571,0 -115.0124327367917,46.31974146790061,0 -115.0238469139813,46.22337559583129,0 -115.0117280659846,46.20245605532157,0 -115.0112266163612,46.11874781707979,0 -115.0110895319581,46.09373889317059,0 -115.0050234342193,46.07709825511041,0 -115.016439541269,45.98523494753368,0 -115.0103330436892,45.96022316741724,0 -115.0103095933478,45.95605564092183,0 -114.9978967682093,45.86438495758158,0 -114.9858235974111,45.83105690689725,0 -114.9797530527736,45.80606686847023,0 -114.9736685070068,45.77691709683077,0 -114.9736091901629,45.76442755043837,0 -114.9853838535323,45.7436193713809,0 -115.0850670406254,45.55661136868037,0 -115.0849839853562,45.5441529223323,0 -115.0848730380615,45.52754213181453,0 -115.0846789432084,45.49847551570731,0 -115.0727508937568,45.48187614481012,0 -115.0726976502611,45.47357232968118,0 -115.0072877697808,45.39056675731784,0 -114.9836659892052,45.38228538157548,0 -114.9482852609312,45.37817644234811,0 -114.9011335562276,45.37412374875422,0 -114.8716720557612,45.37416493709832,0 -114.7537860386839,45.20399962270076,0 -114.7420412246252,45.17904655850364,0 -114.7361750782883,45.15826157262845,0 -114.7185957964211,45.12084625598283,0 -114.6951638410072,45.10834901382286,0 -114.6893047987575,45.10833932920353,0 -114.5194696161416,45.08739291942656,0 -114.507815771374,45.07492179986966,0 -114.5020022049039,45.06660906855402,0 -114.4669885323518,45.04580335845039,0 -114.4790907245684,44.97120373086626,0 -114.4910553580358,44.90919267840379,0 -114.5029761490115,44.85131945044042,0 -114.5032187886872,44.79343261832522,0 -114.5033751818768,44.75622104257622,0 -114.5035309468807,44.71900933789095,0 -114.5035482949188,44.7148751371301,0 -114.4458189898049,44.62793990068387,0 -114.4285323643747,44.60308373945232,0 -114.3996508090063,44.578198203611,0 -114.359099955773,44.56568171313244,0 -114.3358810625386,44.5656154569839,0 -114.318368621875,44.57797286071318,0 -114.2601479243369,44.59433346505103,0 -114.219733855866,44.57344529828951,0 -114.2083363845384,44.55270404971715,0 -114.1795684863154,44.53186585101214,0 -114.1565716078345,44.51519274615343,0 -114.1161786512494,44.50254582235378,0 -114.0054936924597,44.53506359291369,0 -113.9765392223411,44.53074793942147,0 -113.9475199599198,44.5305658994362,0 -113.9185697842453,44.52623538754309,0 -113.9014568580483,44.50955144464482,0 -113.8729415748256,44.48448661648983,0 -113.8329638569053,44.45518716577946,0 -113.8157665328423,44.44676651292857,0 -113.7869275528635,44.44238331002821,0 -113.5792736628876,44.38684255688955,0 -113.5391342388351,44.36577813715391,0 -113.5046325445884,44.35302406373577,0 -113.4761276204001,44.3361652512756,0 -113.447443969133,44.32757042211952,0 -113.2355844052655,44.25056154110015,0 -113.2242673604526,44.23802055167906,0 -113.2014661333721,44.22119388740074,0 -113.1669505086246,44.212467264758,0 -113.0179015415448,44.15660021942062,0 -113.000864983198,44.14393662469467,0 -112.9671067140107,44.10618945014401,0 -112.927202409876,44.08487703687194,0 -112.8986522462094,44.0720067027046,0 -112.8584633161929,44.06307598427906,0 -112.8234395924371,44.0707761514816,0 -112.653942912874,44.10510523962561,0 -112.6191776912474,44.10447123106104,0 -112.5955783449426,44.11646298578311,0 -112.577764524552,44.12855920304877,0 -112.5479142701074,44.15285447766186,0 -112.4473110455066,44.20477715701215,0 -112.4182577820703,44.2042043760166,0 -112.4008239287613,44.20385690886631,0 -112.3656421131116,44.21143608769279,0 -112.2179586773814,44.26638070475983,0 -112.1826902262358,44.27391028497051,0 -112.147075386521,44.28971409610138,0 -112.1174442880061,44.30149548337209,0 -112.1112519268054,44.30965126051775,0 -112.0053078079586,44.33212115646242,0 -111.9822062143456,44.32743331837653,0 -111.9591060086625,44.32274071592411,0 -111.9125092140686,44.32162830837738,0 -111.8950337366258,44.32120632283529,0 -111.8659065620845,44.32049715933956,0 -111.8192986211198,44.31934610611601,0 -111.6976964058436,44.29552705927182,0 -111.6868123335101,44.27864582952392,0 -111.6586072610191,44.25715897908761,0 -111.6418957419397,44.24011561832602,0 -111.6141277742611,44.21031723992546,0 -111.6089076441139,44.19772095709141,0 -111.6038954813378,44.18097767711547,0 -111.599092892975,44.16008575689482,0 -111.5769713794156,44.03072361714089,0 -111.5719920380823,44.01397131584435,0 -111.5678444607325,43.98062591036578,0 -111.5630786109375,43.95972186805293,0 -111.5641305758258,43.93897973263073,0 -111.5649976971235,43.92238747803744,0 -111.5658635897016,43.90579431259697,0 -111.5727393366591,43.88521514050598,0 -111.5864779305266,43.84405574332362,0 -111.5877666472752,43.81916553467468,0 -111.5886245817565,43.80257126077765,0 -111.5892617408479,43.79012487951882,0 -111.5710132561807,43.58184064520177,0 -111.567010950853,43.54848617916618,0 -111.5477187013166,43.4772898803397,0 -111.5286837867527,43.40193406570653,0 -111.5143263022067,43.34748657515492,0 -111.5099184497764,43.32242181883304,0 -111.5110344192922,43.30167764560936,0 -111.4826595537802,43.05942888998051,0 -111.4753514425234,42.84661036691513,0 -111.4707647590125,42.82142705100452,0 -111.4661806295954,42.79624035193564,0 -111.4720428933151,42.66702882269063,0 -111.532886209021,42.44321115329405,0 -111.5407005292869,42.39326400053805,0 -111.6447967475693,42.34206871892982,0 -111.9105967114048,42.35844010327858,0 -111.9844082473932,42.35642596477174,0 -112.0297771192166,42.35776880230296,0 -112.092141716707,42.35958511745753,0 -112.1544795795495,42.36136296066184,0 -112.2334274674152,42.3718610151279,0 -112.3013273927423,42.37366416937771,0 -112.7545196358284,42.32584378726036,0 -112.8229558419704,42.29387539957304,0 -112.8686003855023,42.2697541864442,0 -112.8798326809832,42.26995777905876,0 -113.1391967205496,42.22856929983264,0 -113.1729574140072,42.22494210296892,0 -113.2291692112021,42.22166636235146,0 -113.2684578422454,42.22228304514471,0 -113.3920065488002,42.21998714419034,0 -113.4315969474648,42.20390981752568,0 -113.4428931436969,42.19990917460759,0 -113.5772416223795,42.21416293229829,0 -113.6109782103869,42.2061951843501,0 -113.6390425577422,42.20232116433209,0 -113.6614396812481,42.20254522151852,0 -113.8348010445104,42.22077514712795,0 -113.8572040066304,42.22096113312142,0 -113.9132867232643,42.21730604282396,0 -113.9638559532209,42.20954768821557,0 -114.0199263637009,42.21015659574156,0 -114.0647734393454,42.21062319454084,0 -114.0927979901413,42.21090582213581,0 -114.1263531148137,42.21956161674636,0 -114.2829862534468,42.24559322520646,0 -114.3053957104002,42.24148457152193,0 -114.333398161921,42.23737965324969,0 -114.4229706576466,42.22917538546029,0 -114.4286881049647,42.20428279888859,0 -114.4511188959597,42.19184457360971,0 -114.4623043920662,42.19184815129509,0 -114.5517268045068,42.21673801378627,0 -114.5797401743295,42.20427056509625,0 -114.5965284319198,42.20426605438328,0 -114.6077138756127,42.20844293753802,0 -114.7308428654029,42.23773039566428,0 -114.7644367149703,42.23775217615367,0 -114.7924283330337,42.23360449314931,0 -114.8148219651195,42.2336085801293,0 -114.848424243967,42.24192542683591,0 -114.8876415877027,42.25438860010998,0 -115.1735241312179,42.29085689640822,0 -115.2127570293879,42.29066700515634,0 -115.2407746907273,42.29054895650617,0 -115.2687920128085,42.29042433999057,0 -115.3305773660155,42.3067334941339,0 -115.375590346588,42.323058389395,0 -115.4375025750088,42.34339730723841,0 -115.5049784937011,42.35534205562797,0 -115.5215857125475,42.3344096385948,0 -115.5384666431918,42.33842858743054,0 -115.7693983257018,42.39454542803388,0 -115.8029682716908,42.38588893933238,0 -115.8309806772761,42.38144093265324,0 -115.8533743770915,42.37704773777102,0 -115.8758324020842,42.37680918932316,0 -115.9095887891002,42.38060323851358,0 -115.9546514223581,42.3884188354471,0 -115.9885668410731,42.40050875735841,0 -116.1242836723729,42.43606942213518,0 -116.1523124944119,42.43153370790873,0 -116.1804165775213,42.43115973446221,0 -116.2028999393788,42.4308553532052,0 -116.2370296831622,42.45122992450382,0 -116.2539785798912,42.45516089097166,0 -116.2883012279333,42.4838523503974,0 -116.3275038852574,42.47494631380857,0 -116.3443766379555,42.47469692212751,0 -116.4973485592574,42.50535262857332,0 -116.5203115568672,42.52159566872793,0 -116.5262491829044,42.53398833052764,0 -116.5554176760238,42.57090745896809,0 -116.6316035650911,42.67349106235886,0 -116.6205039050965,42.68202759765872,0 -116.6094019853654,42.69056268162687,0 -116.604174227369,42.70730470927796,0 -116.5876199161996,42.72426004443687,0 -116.570952417194,42.73705296545317,0 -116.5262446431967,42.75438742888687,0 -116.5036620934929,42.75474479257066,0 -116.4641419936986,42.75535997538039,0 -116.4355814337798,42.74334791007931,0 -116.4014963130385,42.73556054161534,0 -116.3901004143324,42.7315793038555,0 -116.311367369453,42.74518488363025,0 -116.2943230876435,42.74128092059703,0 -116.2830287548085,42.74144225784668,0 -116.0628057107978,42.7443530038231,0 -116.0230332151692,42.73238486440457,0 -115.9776344530728,42.72046489040585,0 -115.9435393350305,42.70840223457729,0 -115.9096088723241,42.70462533915669,0 -115.8757568417473,42.70498695195779,0 -115.8306895698128,42.70960331104887,0 -115.8081081796678,42.70984639401467,0 -115.6956905528622,42.74419761413046,0 -115.6615769943071,42.72791830885373,0 -115.6331282836228,42.71157521127623,0 -115.6160330767719,42.69927584744058,0 -115.5877155939607,42.69122227849375,0 -115.5593554892114,42.67901244854591,0 -115.5254659595583,42.67514202174063,0 -115.4071300282221,42.68434110302086,0 -115.3902125301885,42.6844587050192,0 -115.3676568618605,42.68461198104002,0 -115.3451017927286,42.68476104934332,0 -115.3112712703815,42.68497501774458,0 -115.2324032624433,42.68948808711527,0 -114.9225072663851,42.73622933460791,0 -114.8999298890236,42.72795935519775,0 -114.8660885256057,42.72385096057288,0 -114.8209705576189,42.7155892270153,0 -114.798419286789,42.71560500493271,0 -114.7589546769826,42.71563153025121,0 -114.612340810709,42.73639768388746,0 -114.5898018344052,42.7280587456241,0 -114.5616296753946,42.71970354817778,0 -114.5221764286834,42.71547219588116,0 -114.4714688720598,42.7070444872854,0 -114.4320459841146,42.69862693746521,0 -114.3925909379764,42.69850816147541,0 -114.2514554095688,42.73121744299992,0 -114.2288957548127,42.73110436272028,0 -114.2063352077151,42.7309871375192,0 -114.1612480000282,42.72658470767429,0 -114.099282379795,42.71790447922933,0 -114.037244144167,42.71749368811564,0 -113.8565286075136,42.73269982670615,0 -113.7664476058787,42.71523145404309,0 -113.6820445132508,42.69775376449956,0 -113.6258168259781,42.68468228400917,0 -113.5694011788403,42.6840527246807,0 -113.4787704504678,42.70378240639485,0 -113.4617662057252,42.70773477625528,0 -113.422106579511,42.71555919164376,0 -113.2741127282081,42.77178329858746,0 -113.2401881746179,42.77128864994437,0 -113.2119165993036,42.77086845876937,0 -113.1779850058196,42.77035288429335,0 -113.1383968909391,42.76973880944224,0 -113.1099337227236,42.77760965841447,0 -113.0247763549975,42.7844608036941,0 -113.0021081201116,42.78405513085952,0 -112.9568736185882,42.77907532941441,0 -112.88907466718,42.76949216739011,0 -112.8382947994598,42.7602073026908,0 -112.7930998077234,42.75518662137651,0 -112.6798054640018,42.75294749011307,0 -112.6684742676506,42.75271736412022,0 -112.6402739960063,42.74798101870027,0 -112.6006370446581,42.74717225519894,0 -112.5556018574039,42.73791824539248,0 -112.4989799467992,42.73671796742028,0 -112.3850775696685,42.7635404170135,0 -112.3623455191282,42.7672283969621,0 -112.3339640615981,42.77079301609714,0 -112.2996351080287,42.78254141453172,0 -112.2425481615103,42.79794290389399,0 -112.219424966061,42.80987694429766,0 -112.183722021956,42.85901507071508,0 -112.1664080757751,42.86692325668243,0 -112.1488037931604,42.88315268325113,0 -112.1365682169509,42.90360301407598,0 -112.1297470184807,42.92830241929242,0 -112.1275098879299,42.97800596823529,0 -112.1640497442191,43.05355283326228,0 -112.169720977313,43.05368026671578,0 -112.2028499740888,43.07515596312246,0 -112.23068395727,43.08821120664148,0 -112.3154337706659,43.10253385129003,0 -112.3559729882825,43.08684707000809,0 -112.3787904006707,43.0873680374895,0 -112.6184334171694,43.08842285316437,0 -112.6526356315118,43.08912669420177,0 -112.6754356029512,43.08959078172585,0 -112.7269379044262,43.08229782064032,0 -112.7612052636403,43.07879847013555,0 -112.8182255011034,43.07571237860338,0 -112.858166726836,43.0722903666957,0 -112.9150649494357,43.07331583532101,0 -113.131249353817,43.07698575117517,0 -113.1710691365223,43.07762427745074,0 -113.1995078528235,43.07807183699127,0 -113.227910584807,43.07849010577638,0 -113.2790229770006,43.07921838916241,0 -113.3471656318121,43.08015419370793,0 -113.5906856668714,43.11211661028757,0 -113.6133233620432,43.11651102402995,0 -113.6870494332485,43.12142506444243,0 -113.7324525373211,43.12186822003555,0 -113.772178949086,43.1222409199108,0 -113.8515734627474,43.12709365672135,0 -113.953703900377,43.12790342276723,0 -114.3392636111291,43.16332979478258,0 -114.3960055108784,43.16355356035754,0 -114.4243755295988,43.16365523091024,0 -114.4640912554764,43.16378541762754,0 -114.5321699380684,43.16397563995604,0 -114.6172531023489,43.16410102982985,0 -114.668292912014,43.17242688110221,0 -115.1167779568862,43.23821548156109,0 -115.1565014673227,43.23392599952138,0 -115.167856342178,43.23388357054493,0 -115.1905665920597,43.23379573198282,0 -115.2586959851915,43.23350568778603,0 -115.3155041032814,43.23737677716282,0 -115.3667522744229,43.24529437350969,0 -115.6579494107751,43.31322409655101,0 -115.6807324703573,43.31301392840057,0 -115.7034611050924,43.30865202468307,0 -115.7319442435212,43.30837600025206,0 -115.8060091492705,43.307624885476,0 -116.0348110770056,43.34645535549053,0 -116.040524290509,43.3463800774415,0 -116.0865597551342,43.36235265897464,0 -116.1269933244161,43.38253639789843,0 -116.1561022146091,43.40701703448929,0 -116.3704040121673,43.51588502094826,0 -116.3881276397491,43.53634268675015,0 -116.4595237641468,43.6305712542591,0 -116.4955192166878,43.68387989591044,0 -116.6081351164771,43.79395193076449,0 -116.6559006438203,43.84703463606561,0 -116.6710776157369,43.96285084027779,0 -116.6372825204959,43.9924368719155,0 -116.6203130573653,44.005152986487,0 -116.5805749217428,44.03066659485192,0 -116.5458855177979,44.03121902494846,0 -116.2279570474216,44.03579892936426,0 -116.1642831982752,44.03661238989189,0 -116.0947534479989,44.03332144388957,0 -115.8983077194205,44.02307413986659,0 -115.8522277398724,44.023532058001,0 -115.8234299323985,44.023808583769,0 -115.7886467701507,44.01172633836805,0 -115.4587050684312,43.85718644499352,0 -115.401065079329,43.83274071971589,0 -115.1999101880234,43.77178713751671,0 -115.1196523074674,43.7555713683186,0 -115.0681156936423,43.74746520530326,0 -115.0452125927913,43.74339489765169,0 -115.0108716564099,43.73934982694072,0 -114.7935090151318,43.73972492314648,0 -114.7534795151227,43.74801829790551,0 -114.6734067029236,43.75212530327744,0 -114.5475243087446,43.76435539312223,0 -114.4272433249584,43.78471796740612,0 -114.3871464787982,43.78872660924307,0 -114.3013791620205,43.77188013591194,0 -114.2043621280175,43.73838672050692,0 -114.0729695469597,43.72114933904954,0 -114.0386907880324,43.71680145781445,0 -113.9528870102481,43.71622606412302,0 -113.5113971945039,43.72861628678241,0 -113.3563515783825,43.73087422296694,0 -113.31625002926,43.72621315433045,0 -113.2416768754817,43.72106276017492,0 -113.1727531026464,43.72008865948047,0 -113.1092563819833,43.73158307436223,0 -113.062961406449,43.74330799669326,0 -113.0275678680024,43.77589427995213,0 -113.0500011589101,43.79694500835093,0 -113.123029902656,43.86428081771628,0 -113.190646717666,43.92319251248313,0 -113.247687624042,43.948799972492,0 -113.276430556454,43.95331826961573,0 -113.3109380715561,43.95790148162223,0 -113.4723042933544,43.95984179238202,0 -113.5124168926683,43.97269821020976,0 -113.6214029807969,43.99450605661328,0 -113.78798371169,44.02497156444521,0 -114.0004690492696,44.05547534993733,0 -114.0234090456681,44.05975290999854,0 -114.0636441082119,44.0599981655435,0 -114.1383700853768,44.06041602444761,0 -114.1843229376245,44.06064860738174,0 -114.4773519086526,44.11127628620204,0 -114.511888440103,44.1113482179126,0 -114.569428545644,44.11557659278017,0 -114.6269232732268,44.14043094593505,0 -114.7362826164085,44.17353363877001,0 -114.8169302588477,44.18590797334292,0 -115.0187500448228,44.21454836218777,0 -115.0418662374818,44.22276084281408,0 -115.1457943472498,44.23898387001979,0 -115.232445264015,44.25105508863231,0 -115.4353262845529,44.31208029306954,0 -115.4585712612061,44.32021844175281,0 -115.4819301012749,44.33662114216003,0 -115.499676115577,44.36546011452933,0 -115.5406807896015,44.39828999559731,0 -115.5757119477347,44.41461324635758,0 -115.6631585358345,44.43884945408055,0 -115.6747589333811,44.43876140359078,0 -115.6984503069758,44.46754272940305,0 -115.7276832766526,44.47972475220109,0 -115.9192895888907,44.48213923905242,0 -115.9652771336472,44.46098193754768,0 -116.0056132437678,44.44814090813765,0 -116.040496935959,44.44778682953855,0 -116.1045319692442,44.44712656881087,0 -116.2146421640559,44.42931142819587,0 -116.2611440707129,44.42873877826006,0 -116.3309097214693,44.42784467009132,0 -116.4180831926366,44.42665486799533,0 -116.5110683458608,44.42530977669701,0 -116.5459883656866,44.42479418966615,0 -116.5810468476482,44.42840987192948,0 -116.6219372997722,44.43192505235232,0 -116.7152593397225,44.43458074761863,0 -116.7222400385742,44.46762834917055,0 -116.7298088125386,44.51725040103551,0 -116.7368067824367,44.55030143393893,0 -116.7257169550902,44.56706559921108,0 -116.709210785396,44.59635106742589,0 -116.6988266018662,44.63382996747108,0 -116.6883295807998,44.6671772244674,0 -116.6723911253887,44.71304525315867,0 -116.6609904648191,44.7215199148754,0 -116.6331777051901,44.76342294778846,0 -116.5925186804495,44.77234026143407,0 -116.5812324892437,44.78495006304969,0 -116.5059601163483,44.81092682797617,0 -116.4591106518937,44.81157277044886,0 -116.371402207366,44.81687399389906,0 -116.1557417518478,44.87303531666081,0 -116.1145755931915,44.86928466832633,0 -116.032196569074,44.85760224307697,0 -115.8796221510918,44.82598889541453,0 -115.7508407603304,44.80234309975662,0 -115.7216975732016,44.80260124412713,0 -115.7041373991822,44.79861185600833,0 -115.440950936443,44.76290663211838,0 -115.4233395756011,44.75469878500453,0 -115.3999559101627,44.75065206767336,0 -115.370648331311,44.73834327537797,0 -115.2709396869062,44.67250795639352,0 -115.2415600015979,44.63953115204014,0 -115.2182171155189,44.62722160573565,0 -115.1717184194692,44.62325432017178,0 -115.1252832197175,44.62753418734305,0 -114.9630884916592,44.72718770824427,0 -114.9696924705345,44.90521382966024,0 -114.9873053164739,44.92589822991106,0 -115.0108842373407,44.9672823588667,0 -115.0524127814108,45.06668743306118,0 -115.0818105597066,45.08320974053012,0 -115.1346729807919,45.09966004176958,0 -115.4404298665915,45.16071349245528,0 -115.4639350324475,45.16061562514526,0 -115.5344418554134,45.1602678413453,0 -115.6399754191879,45.1471789030207,0 -115.6517231915057,45.14710060757215,0 -115.6869382506628,45.14682429259618,0 -115.8339314640518,45.16206447379151,0 -115.8574933805784,45.16598257292201,0 -115.9044695191312,45.1655367219275,0 -116.0101660569934,45.16446159482698,0 -116.1464375686148,45.18012543424623,0 -116.17008526376,45.17995081431845,0 -116.1998899410503,45.18803038609283,0 -116.2479202773556,45.21254936587627,0 -116.2839133006892,45.22884915196181,0 -116.3750120022893,45.29869532665378,0 -116.3517572350585,45.31143891645297,0 -116.3465284871351,45.33231213812437,0 -116.2909762050869,45.45752478482123,0 -116.2735040161229,45.47013064977255,0 -116.2204407275934,45.48713208533464,0 -116.1613043960204,45.4999864812265,0 -116.0964271069365,45.51305241363868,0 -116.0553813132019,45.53006255603626,0 -116.0257163057231,45.5302924438055,0 -115.9783578045165,45.53075645097137,0 -115.9548021043518,45.53516417793286,0 -115.848567770577,45.54864961491077,0 -115.8189021971981,45.5488160321973,0 -115.7716129257286,45.55737556748161,0 -115.7301710933778,45.56173178352132,0 -115.7005148711927,45.56186675975211,0 -115.6474131205278,45.57462730517354,0 -115.5888183970267,45.60835143859602,0 -115.4660722540044,45.71738319339158,0 -115.3436066272317,45.86891215900148,0 -115.2850867418559,45.95295435199103,0 -115.458151346814,45.96008722844529,0 -115.4996305269252,45.94708350293654,0 -115.5529954048333,45.93397012417076,0 -115.5886746524275,45.92949959805522,0 -115.6303035388419,45.92496752350114,0 -115.7496331499345,45.92018466419412,0 -115.7675647636821,45.92011249759399,0 -115.7795201924867,45.92006221445606,0 -115.8224194948925,45.96178600909801,0 -116.0924561064828,45.97305100563992,0 -116.1218713319196,45.95603177774683,0 -116.1576951038827,45.95559286206702,0 -116.2295910788224,45.96302427490681,0 -116.4346819917088,46.01468257841995,0 -116.4352581724175,46.03137573457606,0 -116.4358346144017,46.0480699114224,0 -116.3594603259421,46.24670605401468,0 -116.3055687118751,46.25571933244773,0 -116.2757474572224,46.26444377918238,0 -116.2638440901098,46.26876996864667,0 -116.1157493807662,46.35807881885431,0 -116.0917174727115,46.36245433148264,0 -116.055724080304,46.37110345129632,0 -116.0258752207949,46.38388742797631,0 -115.9598525475714,46.40104413737022,0 -115.9238240545823,46.40965358620716,0 -115.8519517664182,46.43524508067266,0 -115.7925096862146,46.47755448182764,0 -115.7689987057849,46.50708501763546,0 -115.8486476093226,46.54460085139223,0 -115.8614014520867,46.5697728208827,0 -115.8982861818962,46.59053257492454,0 -115.9229687470059,46.60716910874607,0 -116.0213047347513,46.65268098295739,0 -116.0638350810691,46.65239523664275,0 -116.0820636313763,46.65226810396264,0 -116.1486358435086,46.64334455258457,0 -116.1850657605673,46.6430077739178,0 -116.30637391661,46.63760430691082,0 -116.3302359732541,46.62475481422905,0 -116.3653504382744,46.58658752370887,0 -116.4073902868472,46.57355217000369,0 -116.4436506762911,46.56896181723725,0 -116.5430457922166,46.62665245498457,0 -116.5504459102632,46.66019995418202,0 -116.5778037462393,46.73559064524648,0 -116.6117748739337,46.81946322138043,0 -116.6192983583077,46.8531102492312,0 -116.6333069731331,46.89512885443934,0 -116.6293278052723,46.94580567463157,0 -116.6240924914792,46.96696605398445,0 -116.6204727341752,47.0261391437024,0 -116.6184023260912,47.25928428173731,0 -116.6402680818402,47.33145072840058,0 -116.6426334978366,47.38254747558285,0 -116.6277733269076,47.46367684033351,0 -116.6084426364098,47.58342043546187,0 -116.6374201819328,47.66883968447508,0 -116.7278148107358,47.72815810045834,0 -116.7347080458925,47.7409603423159,0 -116.7642485977984,47.83073151153216,0 -116.7646981249468,47.83933711009723,0 -116.7812965840404,47.91668458089658,0'''
    testData2 = testData1.split()
    testData3 = [map(float, s.split(',')) for s in testData1.split()]
    
    # data without z values
    testData4 = '''-116.745874072192,48.08102857446649 -116.5376828123843,47.94063756560327 -116.5242832008861,47.92340213081799 -116.3577461231133,47.53830768548028 -116.3510361075235,47.52556164092302 -116.3312648259745,47.4958632507878 -116.205909251171,47.28391909285293 -116.1866720950459,47.2628005621324 -116.1736249709838,47.2416657624534 -116.1544254473719,47.22055369319131 -116.1288135300576,47.19099797678089 -116.1225181566258,47.18678353025015 -116.0718159765087,47.14037907384641 -116.0592564481853,47.1319514565619 -116.0277559235253,47.10665269303167 -116.0151291610591,47.09407726433773 -115.8943219418863,46.9183133719481 -115.8816004671327,46.8973846192466 -115.7098174383189,46.85210835828622 -115.6973734835807,46.83957016496351 -115.6789287915006,46.83125349087171 -115.2994441764979,46.68026161097462 -115.2810656837552,46.66353371433938 -115.2748583039441,46.65094778758999 -115.232014834245,46.60911182104614 -115.2197366051386,46.59235323119681 -115.1832515274081,46.5715037916163 -115.1043198358729,46.5296420624102 -115.0920698912608,46.50861964866134 -115.0860003414729,46.50442145639163 -115.0308393733827,46.37840268479166 -115.0187007497269,46.36164855632493 -115.0125090385228,46.33231421595571 -115.0124327367917,46.31974146790061 -115.0238469139813,46.22337559583129 -115.0117280659846,46.20245605532157 -115.0112266163612,46.11874781707979 -115.0110895319581,46.09373889317059 -115.0050234342193,46.07709825511041 -115.016439541269,45.98523494753368 -115.0103330436892,45.96022316741724 -115.0103095933478,45.95605564092183 -114.9978967682093,45.86438495758158 -114.9858235974111,45.83105690689725 -114.9797530527736,45.80606686847023 -114.9736685070068,45.77691709683077 -114.9736091901629,45.76442755043837 -114.9853838535323,45.7436193713809 -115.0850670406254,45.55661136868037 -115.0849839853562,45.5441529223323 -115.0848730380615,45.52754213181453 -115.0846789432084,45.49847551570731 -115.0727508937568,45.48187614481012 -115.0726976502611,45.47357232968118 -115.0072877697808,45.39056675731784 -114.9836659892052,45.38228538157548 -114.9482852609312,45.37817644234811 -114.9011335562276,45.37412374875422 -114.8716720557612,45.37416493709832 -114.7537860386839,45.20399962270076 -114.7420412246252,45.17904655850364 -114.7361750782883,45.15826157262845 -114.7185957964211,45.12084625598283 -114.6951638410072,45.10834901382286 -114.6893047987575,45.10833932920353 -114.5194696161416,45.08739291942656 -114.507815771374,45.07492179986966 -114.5020022049039,45.06660906855402 -114.4669885323518,45.04580335845039 -114.4790907245684,44.97120373086626 -114.4910553580358,44.90919267840379 -114.5029761490115,44.85131945044042 -114.5032187886872,44.79343261832522 -114.5033751818768,44.75622104257622 -114.5035309468807,44.71900933789095 -114.5035482949188,44.7148751371301 -114.4458189898049,44.62793990068387 -114.4285323643747,44.60308373945232 -114.3996508090063,44.578198203611 -114.359099955773,44.56568171313244 -114.3358810625386,44.5656154569839 -114.318368621875,44.57797286071318 -114.2601479243369,44.59433346505103 -114.219733855866,44.57344529828951 -114.2083363845384,44.55270404971715 -114.1795684863154,44.53186585101214 -114.1565716078345,44.51519274615343 -114.1161786512494,44.50254582235378 -114.0054936924597,44.53506359291369 -113.9765392223411,44.53074793942147 -113.9475199599198,44.5305658994362 -113.9185697842453,44.52623538754309 -113.9014568580483,44.50955144464482 -113.8729415748256,44.48448661648983 -113.8329638569053,44.45518716577946 -113.8157665328423,44.44676651292857 -113.7869275528635,44.44238331002821 -113.5792736628876,44.38684255688955 -113.5391342388351,44.36577813715391 -113.5046325445884,44.35302406373577 -113.4761276204001,44.3361652512756 -113.447443969133,44.32757042211952 -113.2355844052655,44.25056154110015 -113.2242673604526,44.23802055167906 -113.2014661333721,44.22119388740074 -113.1669505086246,44.212467264758 -113.0179015415448,44.15660021942062 -113.000864983198,44.14393662469467 -112.9671067140107,44.10618945014401 -112.927202409876,44.08487703687194 -112.8986522462094,44.0720067027046 -112.8584633161929,44.06307598427906 -112.8234395924371,44.0707761514816 -112.653942912874,44.10510523962561 -112.6191776912474,44.10447123106104 -112.5955783449426,44.11646298578311 -112.577764524552,44.12855920304877 -112.5479142701074,44.15285447766186 -112.4473110455066,44.20477715701215 -112.4182577820703,44.2042043760166 -112.4008239287613,44.20385690886631 -112.3656421131116,44.21143608769279 -112.2179586773814,44.26638070475983 -112.1826902262358,44.27391028497051 -112.147075386521,44.28971409610138 -112.1174442880061,44.30149548337209 -112.1112519268054,44.30965126051775 -112.0053078079586,44.33212115646242 -111.9822062143456,44.32743331837653 -111.9591060086625,44.32274071592411 -111.9125092140686,44.32162830837738 -111.8950337366258,44.32120632283529 -111.8659065620845,44.32049715933956 -111.8192986211198,44.31934610611601 -111.6976964058436,44.29552705927182 -111.6868123335101,44.27864582952392 -111.6586072610191,44.25715897908761 -111.6418957419397,44.24011561832602 -111.6141277742611,44.21031723992546 -111.6089076441139,44.19772095709141 -111.6038954813378,44.18097767711547 -111.599092892975,44.16008575689482 -111.5769713794156,44.03072361714089 -111.5719920380823,44.01397131584435 -111.5678444607325,43.98062591036578 -111.5630786109375,43.95972186805293 -111.5641305758258,43.93897973263073 -111.5649976971235,43.92238747803744 -111.5658635897016,43.90579431259697 -111.5727393366591,43.88521514050598 -111.5864779305266,43.84405574332362 -111.5877666472752,43.81916553467468 -111.5886245817565,43.80257126077765 -111.5892617408479,43.79012487951882 -111.5710132561807,43.58184064520177 -111.567010950853,43.54848617916618 -111.5477187013166,43.4772898803397 -111.5286837867527,43.40193406570653 -111.5143263022067,43.34748657515492 -111.5099184497764,43.32242181883304 -111.5110344192922,43.30167764560936 -111.4826595537802,43.05942888998051 -111.4753514425234,42.84661036691513 -111.4707647590125,42.82142705100452 -111.4661806295954,42.79624035193564 -111.4720428933151,42.66702882269063 -111.532886209021,42.44321115329405 -111.5407005292869,42.39326400053805 -111.6447967475693,42.34206871892982 -111.9105967114048,42.35844010327858 -111.9844082473932,42.35642596477174 -112.0297771192166,42.35776880230296 -112.092141716707,42.35958511745753 -112.1544795795495,42.36136296066184 -112.2334274674152,42.3718610151279 -112.3013273927423,42.37366416937771 -112.7545196358284,42.32584378726036 -112.8229558419704,42.29387539957304 -112.8686003855023,42.2697541864442 -112.8798326809832,42.26995777905876 -113.1391967205496,42.22856929983264 -113.1729574140072,42.22494210296892 -113.2291692112021,42.22166636235146 -113.2684578422454,42.22228304514471 -113.3920065488002,42.21998714419034 -113.4315969474648,42.20390981752568 -113.4428931436969,42.19990917460759 -113.5772416223795,42.21416293229829 -113.6109782103869,42.2061951843501 -113.6390425577422,42.20232116433209 -113.6614396812481,42.20254522151852 -113.8348010445104,42.22077514712795 -113.8572040066304,42.22096113312142 -113.9132867232643,42.21730604282396 -113.9638559532209,42.20954768821557 -114.0199263637009,42.21015659574156 -114.0647734393454,42.21062319454084 -114.0927979901413,42.21090582213581 -114.1263531148137,42.21956161674636 -114.2829862534468,42.24559322520646 -114.3053957104002,42.24148457152193 -114.333398161921,42.23737965324969 -114.4229706576466,42.22917538546029 -114.4286881049647,42.20428279888859 -114.4511188959597,42.19184457360971 -114.4623043920662,42.19184815129509 -114.5517268045068,42.21673801378627 -114.5797401743295,42.20427056509625 -114.5965284319198,42.20426605438328 -114.6077138756127,42.20844293753802 -114.7308428654029,42.23773039566428 -114.7644367149703,42.23775217615367 -114.7924283330337,42.23360449314931 -114.8148219651195,42.2336085801293 -114.848424243967,42.24192542683591 -114.8876415877027,42.25438860010998 -115.1735241312179,42.29085689640822 -115.2127570293879,42.29066700515634 -115.2407746907273,42.29054895650617 -115.2687920128085,42.29042433999057 -115.3305773660155,42.3067334941339 -115.375590346588,42.323058389395 -115.4375025750088,42.34339730723841 -115.5049784937011,42.35534205562797 -115.5215857125475,42.3344096385948 -115.5384666431918,42.33842858743054 -115.7693983257018,42.39454542803388 -115.8029682716908,42.38588893933238 -115.8309806772761,42.38144093265324 -115.8533743770915,42.37704773777102 -115.8758324020842,42.37680918932316 -115.9095887891002,42.38060323851358 -115.9546514223581,42.3884188354471 -115.9885668410731,42.40050875735841 -116.1242836723729,42.43606942213518 -116.1523124944119,42.43153370790873 -116.1804165775213,42.43115973446221 -116.2028999393788,42.4308553532052 -116.2370296831622,42.45122992450382 -116.2539785798912,42.45516089097166 -116.2883012279333,42.4838523503974 -116.3275038852574,42.47494631380857 -116.3443766379555,42.47469692212751 -116.4973485592574,42.50535262857332 -116.5203115568672,42.52159566872793 -116.5262491829044,42.53398833052764 -116.5554176760238,42.57090745896809 -116.6316035650911,42.67349106235886 -116.6205039050965,42.68202759765872 -116.6094019853654,42.69056268162687 -116.604174227369,42.70730470927796 -116.5876199161996,42.72426004443687 -116.570952417194,42.73705296545317 -116.5262446431967,42.75438742888687 -116.5036620934929,42.75474479257066 -116.4641419936986,42.75535997538039 -116.4355814337798,42.74334791007931 -116.4014963130385,42.73556054161534 -116.3901004143324,42.7315793038555 -116.311367369453,42.74518488363025 -116.2943230876435,42.74128092059703 -116.2830287548085,42.74144225784668 -116.0628057107978,42.7443530038231 -116.0230332151692,42.73238486440457 -115.9776344530728,42.72046489040585 -115.9435393350305,42.70840223457729 -115.9096088723241,42.70462533915669 -115.8757568417473,42.70498695195779 -115.8306895698128,42.70960331104887 -115.8081081796678,42.70984639401467 -115.6956905528622,42.74419761413046 -115.6615769943071,42.72791830885373 -115.6331282836228,42.71157521127623 -115.6160330767719,42.69927584744058 -115.5877155939607,42.69122227849375 -115.5593554892114,42.67901244854591 -115.5254659595583,42.67514202174063 -115.4071300282221,42.68434110302086 -115.3902125301885,42.6844587050192 -115.3676568618605,42.68461198104002 -115.3451017927286,42.68476104934332 -115.3112712703815,42.68497501774458 -115.2324032624433,42.68948808711527 -114.9225072663851,42.73622933460791 -114.8999298890236,42.72795935519775 -114.8660885256057,42.72385096057288 -114.8209705576189,42.7155892270153 -114.798419286789,42.71560500493271 -114.7589546769826,42.71563153025121 -114.612340810709,42.73639768388746 -114.5898018344052,42.7280587456241 -114.5616296753946,42.71970354817778 -114.5221764286834,42.71547219588116 -114.4714688720598,42.7070444872854 -114.4320459841146,42.69862693746521 -114.3925909379764,42.69850816147541 -114.2514554095688,42.73121744299992 -114.2288957548127,42.73110436272028 -114.2063352077151,42.7309871375192 -114.1612480000282,42.72658470767429 -114.099282379795,42.71790447922933 -114.037244144167,42.71749368811564 -113.8565286075136,42.73269982670615 -113.7664476058787,42.71523145404309 -113.6820445132508,42.69775376449956 -113.6258168259781,42.68468228400917 -113.5694011788403,42.6840527246807 -113.4787704504678,42.70378240639485 -113.4617662057252,42.70773477625528 -113.422106579511,42.71555919164376 -113.2741127282081,42.77178329858746 -113.2401881746179,42.77128864994437 -113.2119165993036,42.77086845876937 -113.1779850058196,42.77035288429335 -113.1383968909391,42.76973880944224 -113.1099337227236,42.77760965841447 -113.0247763549975,42.7844608036941 -113.0021081201116,42.78405513085952 -112.9568736185882,42.77907532941441 -112.88907466718,42.76949216739011 -112.8382947994598,42.7602073026908 -112.7930998077234,42.75518662137651 -112.6798054640018,42.75294749011307 -112.6684742676506,42.75271736412022 -112.6402739960063,42.74798101870027 -112.6006370446581,42.74717225519894 -112.5556018574039,42.73791824539248 -112.4989799467992,42.73671796742028 -112.3850775696685,42.7635404170135 -112.3623455191282,42.7672283969621 -112.3339640615981,42.77079301609714 -112.2996351080287,42.78254141453172 -112.2425481615103,42.79794290389399 -112.219424966061,42.80987694429766 -112.183722021956,42.85901507071508 -112.1664080757751,42.86692325668243 -112.1488037931604,42.88315268325113 -112.1365682169509,42.90360301407598 -112.1297470184807,42.92830241929242 -112.1275098879299,42.97800596823529 -112.1640497442191,43.05355283326228 -112.169720977313,43.05368026671578 -112.2028499740888,43.07515596312246 -112.23068395727,43.08821120664148 -112.3154337706659,43.10253385129003 -112.3559729882825,43.08684707000809 -112.3787904006707,43.0873680374895 -112.6184334171694,43.08842285316437 -112.6526356315118,43.08912669420177 -112.6754356029512,43.08959078172585 -112.7269379044262,43.08229782064032 -112.7612052636403,43.07879847013555 -112.8182255011034,43.07571237860338 -112.858166726836,43.0722903666957 -112.9150649494357,43.07331583532101 -113.131249353817,43.07698575117517 -113.1710691365223,43.07762427745074 -113.1995078528235,43.07807183699127 -113.227910584807,43.07849010577638 -113.2790229770006,43.07921838916241 -113.3471656318121,43.08015419370793 -113.5906856668714,43.11211661028757 -113.6133233620432,43.11651102402995 -113.6870494332485,43.12142506444243 -113.7324525373211,43.12186822003555 -113.772178949086,43.1222409199108 -113.8515734627474,43.12709365672135 -113.953703900377,43.12790342276723 -114.3392636111291,43.16332979478258 -114.3960055108784,43.16355356035754 -114.4243755295988,43.16365523091024 -114.4640912554764,43.16378541762754 -114.5321699380684,43.16397563995604 -114.6172531023489,43.16410102982985 -114.668292912014,43.17242688110221 -115.1167779568862,43.23821548156109 -115.1565014673227,43.23392599952138 -115.167856342178,43.23388357054493 -115.1905665920597,43.23379573198282 -115.2586959851915,43.23350568778603 -115.3155041032814,43.23737677716282 -115.3667522744229,43.24529437350969 -115.6579494107751,43.31322409655101 -115.6807324703573,43.31301392840057 -115.7034611050924,43.30865202468307 -115.7319442435212,43.30837600025206 -115.8060091492705,43.307624885476 -116.0348110770056,43.34645535549053 -116.040524290509,43.3463800774415 -116.0865597551342,43.36235265897464 -116.1269933244161,43.38253639789843 -116.1561022146091,43.40701703448929 -116.3704040121673,43.51588502094826 -116.3881276397491,43.53634268675015 -116.4595237641468,43.6305712542591 -116.4955192166878,43.68387989591044 -116.6081351164771,43.79395193076449 -116.6559006438203,43.84703463606561 -116.6710776157369,43.96285084027779 -116.6372825204959,43.9924368719155 -116.6203130573653,44.005152986487 -116.5805749217428,44.03066659485192 -116.5458855177979,44.03121902494846 -116.2279570474216,44.03579892936426 -116.1642831982752,44.03661238989189 -116.0947534479989,44.03332144388957 -115.8983077194205,44.02307413986659 -115.8522277398724,44.023532058001 -115.8234299323985,44.023808583769 -115.7886467701507,44.01172633836805 -115.4587050684312,43.85718644499352 -115.401065079329,43.83274071971589 -115.1999101880234,43.77178713751671 -115.1196523074674,43.7555713683186 -115.0681156936423,43.74746520530326 -115.0452125927913,43.74339489765169 -115.0108716564099,43.73934982694072 -114.7935090151318,43.73972492314648 -114.7534795151227,43.74801829790551 -114.6734067029236,43.75212530327744 -114.5475243087446,43.76435539312223 -114.4272433249584,43.78471796740612 -114.3871464787982,43.78872660924307 -114.3013791620205,43.77188013591194 -114.2043621280175,43.73838672050692 -114.0729695469597,43.72114933904954 -114.0386907880324,43.71680145781445 -113.9528870102481,43.71622606412302 -113.5113971945039,43.72861628678241 -113.3563515783825,43.73087422296694 -113.31625002926,43.72621315433045 -113.2416768754817,43.72106276017492 -113.1727531026464,43.72008865948047 -113.1092563819833,43.73158307436223 -113.062961406449,43.74330799669326 -113.0275678680024,43.77589427995213 -113.0500011589101,43.79694500835093 -113.123029902656,43.86428081771628 -113.190646717666,43.92319251248313 -113.247687624042,43.948799972492 -113.276430556454,43.95331826961573 -113.3109380715561,43.95790148162223 -113.4723042933544,43.95984179238202 -113.5124168926683,43.97269821020976 -113.6214029807969,43.99450605661328 -113.78798371169,44.02497156444521 -114.0004690492696,44.05547534993733 -114.0234090456681,44.05975290999854 -114.0636441082119,44.0599981655435 -114.1383700853768,44.06041602444761 -114.1843229376245,44.06064860738174 -114.4773519086526,44.11127628620204 -114.511888440103,44.1113482179126 -114.569428545644,44.11557659278017 -114.6269232732268,44.14043094593505 -114.7362826164085,44.17353363877001 -114.8169302588477,44.18590797334292 -115.0187500448228,44.21454836218777 -115.0418662374818,44.22276084281408 -115.1457943472498,44.23898387001979 -115.232445264015,44.25105508863231 -115.4353262845529,44.31208029306954 -115.4585712612061,44.32021844175281 -115.4819301012749,44.33662114216003 -115.499676115577,44.36546011452933 -115.5406807896015,44.39828999559731 -115.5757119477347,44.41461324635758 -115.6631585358345,44.43884945408055 -115.6747589333811,44.43876140359078 -115.6984503069758,44.46754272940305 -115.7276832766526,44.47972475220109 -115.9192895888907,44.48213923905242 -115.9652771336472,44.46098193754768 -116.0056132437678,44.44814090813765 -116.040496935959,44.44778682953855 -116.1045319692442,44.44712656881087 -116.2146421640559,44.42931142819587 -116.2611440707129,44.42873877826006 -116.3309097214693,44.42784467009132 -116.4180831926366,44.42665486799533 -116.5110683458608,44.42530977669701 -116.5459883656866,44.42479418966615 -116.5810468476482,44.42840987192948 -116.6219372997722,44.43192505235232 -116.7152593397225,44.43458074761863 -116.7222400385742,44.46762834917055 -116.7298088125386,44.51725040103551 -116.7368067824367,44.55030143393893 -116.7257169550902,44.56706559921108 -116.709210785396,44.59635106742589 -116.6988266018662,44.63382996747108 -116.6883295807998,44.6671772244674 -116.6723911253887,44.71304525315867 -116.6609904648191,44.7215199148754 -116.6331777051901,44.76342294778846 -116.5925186804495,44.77234026143407 -116.5812324892437,44.78495006304969 -116.5059601163483,44.81092682797617 -116.4591106518937,44.81157277044886 -116.371402207366,44.81687399389906 -116.1557417518478,44.87303531666081 -116.1145755931915,44.86928466832633 -116.032196569074,44.85760224307697 -115.8796221510918,44.82598889541453 -115.7508407603304,44.80234309975662 -115.7216975732016,44.80260124412713 -115.7041373991822,44.79861185600833 -115.440950936443,44.76290663211838 -115.4233395756011,44.75469878500453 -115.3999559101627,44.75065206767336 -115.370648331311,44.73834327537797 -115.2709396869062,44.67250795639352 -115.2415600015979,44.63953115204014 -115.2182171155189,44.62722160573565 -115.1717184194692,44.62325432017178 -115.1252832197175,44.62753418734305 -114.9630884916592,44.72718770824427 -114.9696924705345,44.90521382966024 -114.9873053164739,44.92589822991106 -115.0108842373407,44.9672823588667 -115.0524127814108,45.06668743306118 -115.0818105597066,45.08320974053012 -115.1346729807919,45.09966004176958 -115.4404298665915,45.16071349245528 -115.4639350324475,45.16061562514526 -115.5344418554134,45.1602678413453 -115.6399754191879,45.1471789030207 -115.6517231915057,45.14710060757215 -115.6869382506628,45.14682429259618 -115.8339314640518,45.16206447379151 -115.8574933805784,45.16598257292201 -115.9044695191312,45.1655367219275 -116.0101660569934,45.16446159482698 -116.1464375686148,45.18012543424623 -116.17008526376,45.17995081431845 -116.1998899410503,45.18803038609283 -116.2479202773556,45.21254936587627 -116.2839133006892,45.22884915196181 -116.3750120022893,45.29869532665378 -116.3517572350585,45.31143891645297 -116.3465284871351,45.33231213812437 -116.2909762050869,45.45752478482123 -116.2735040161229,45.47013064977255 -116.2204407275934,45.48713208533464 -116.1613043960204,45.4999864812265 -116.0964271069365,45.51305241363868 -116.0553813132019,45.53006255603626 -116.0257163057231,45.5302924438055 -115.9783578045165,45.53075645097137 -115.9548021043518,45.53516417793286 -115.848567770577,45.54864961491077 -115.8189021971981,45.5488160321973 -115.7716129257286,45.55737556748161 -115.7301710933778,45.56173178352132 -115.7005148711927,45.56186675975211 -115.6474131205278,45.57462730517354 -115.5888183970267,45.60835143859602 -115.4660722540044,45.71738319339158 -115.3436066272317,45.86891215900148 -115.2850867418559,45.95295435199103 -115.458151346814,45.96008722844529 -115.4996305269252,45.94708350293654 -115.5529954048333,45.93397012417076 -115.5886746524275,45.92949959805522 -115.6303035388419,45.92496752350114 -115.7496331499345,45.92018466419412 -115.7675647636821,45.92011249759399 -115.7795201924867,45.92006221445606 -115.8224194948925,45.96178600909801 -116.0924561064828,45.97305100563992 -116.1218713319196,45.95603177774683 -116.1576951038827,45.95559286206702 -116.2295910788224,45.96302427490681 -116.4346819917088,46.01468257841995 -116.4352581724175,46.03137573457606 -116.4358346144017,46.0480699114224 -116.3594603259421,46.24670605401468 -116.3055687118751,46.25571933244773 -116.2757474572224,46.26444377918238 -116.2638440901098,46.26876996864667 -116.1157493807662,46.35807881885431 -116.0917174727115,46.36245433148264 -116.055724080304,46.37110345129632 -116.0258752207949,46.38388742797631 -115.9598525475714,46.40104413737022 -115.9238240545823,46.40965358620716 -115.8519517664182,46.43524508067266 -115.7925096862146,46.47755448182764 -115.7689987057849,46.50708501763546 -115.8486476093226,46.54460085139223 -115.8614014520867,46.5697728208827 -115.8982861818962,46.59053257492454 -115.9229687470059,46.60716910874607 -116.0213047347513,46.65268098295739 -116.0638350810691,46.65239523664275 -116.0820636313763,46.65226810396264 -116.1486358435086,46.64334455258457 -116.1850657605673,46.6430077739178 -116.30637391661,46.63760430691082 -116.3302359732541,46.62475481422905 -116.3653504382744,46.58658752370887 -116.4073902868472,46.57355217000369 -116.4436506762911,46.56896181723725 -116.5430457922166,46.62665245498457 -116.5504459102632,46.66019995418202 -116.5778037462393,46.73559064524648 -116.6117748739337,46.81946322138043 -116.6192983583077,46.8531102492312 -116.6333069731331,46.89512885443934 -116.6293278052723,46.94580567463157 -116.6240924914792,46.96696605398445 -116.6204727341752,47.0261391437024 -116.6184023260912,47.25928428173731 -116.6402680818402,47.33145072840058 -116.6426334978366,47.38254747558285 -116.6277733269076,47.46367684033351 -116.6084426364098,47.58342043546187 -116.6374201819328,47.66883968447508 -116.7278148107358,47.72815810045834 -116.7347080458925,47.7409603423159 -116.7642485977984,47.83073151153216 -116.7646981249468,47.83933711009723 -116.7812965840404,47.91668458089658'''
    testData5 = testData4.split()
    testData6 = [map(float, s.split(',')) for s in testData4.split()]
    
    n = len(testData2)
    testData = [testData1, testData2, testData3, testData4, testData5, testData6]

    # initialize Server
    s = Server.getInstance()

    # get elevations
    elevations = []
    for data in testData:
        elevations.extend(s.getElevations(data))
    
    ## We will use Google's Elevation Service to pull a validation set for the test points
    ## The Elevation Service limits you to 25,000 requests per day
    ## see Pydev/GoogleElevationAPI/ Project

    with open('testdata/validation_elevations.txt') as f:
        validationElevations = [eval(L)['elevation'] for L in f.readlines()]

    print(len(validationElevations))

    # Compare elevationService to GoogleElevationAPI
    err = []
    for i, z in enumerate(elevations):
            err.append(z - validationElevations[i%n])
            print( i, z, validationElevations[i%n], err[-1])

    # calculate test error
    print('\nRMS:',np.mean(np.array(err)**2)**0.5)
